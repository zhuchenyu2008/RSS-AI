<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>RSS‑AI 控制台</title>
  <link rel="stylesheet" href="./styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div id="app">
    <header class="header">
      <div class="brand">RSS‑AI</div>
      <nav class="nav">
        <button class="tab-btn active" data-tab="content">内容</button>
        <button class="tab-btn" data-tab="settings">设置</button>
      </nav>
    </header>

    <main>
      <section id="content" class="tab active">
        <div class="toolbar">
          <div class="toolbar-row row1">
            <select id="feedSelect" class="select"></select>
            <button id="refreshBtn" class="primary">手动抓取</button>
          </div>
          <div class="toolbar-row row2">
            <label class="switch as-btn">
              <input type="checkbox" id="autoRefresh" />
              <span>自动刷新</span>
            </label>
            <label class="switch as-btn"><input type="checkbox" id="forceFetch" /><span>强制抓取</span></label>
            <span id="statusText"></span>
          </div>
        </div>
        <div id="articles" class="list"></div>
        <div class="pager">
          <button id="prevPage">上一页</button>
          <span id="pageInfo"></span>
          <button id="nextPage">下一页</button>
        </div>
      </section>

      <section id="settings" class="tab">
        <form id="settingsForm" class="settings-form">
          <fieldset>
            <legend>抓取与存储</legend>
            <label>
              抓取间隔（分钟）
              <input type="number" id="interval" min="1" max="1440" />
            </label>
            <label>
              存储上限（条）
              <input type="number" id="maxItems" min="10" max="50000" />
            </label>
            <label>
              单源抓取上限（每次）
              <input type="number" id="perFeedLimit" min="1" max="1000" />
            </label>
            <label>
              RSS 列表（每行一个URL）
              <textarea id="feeds" rows="6" placeholder="https://..."></textarea>
            </label>
            <label class="switch">
              <input type="checkbox" id="useArticlePage" />
              <span>使用原文抽取正文</span>
            </label>
            <label>
              原文抓取超时（秒）
              <input type="number" id="articleTimeout" min="5" max="60" />
            </label>
          </fieldset>

          <fieldset>
            <legend>AI 设置（OpenAI兼容）</legend>
            <label>
              启用AI
              <input type="checkbox" id="aiEnabled" />
            </label>
            <label>
              API Base URL
              <input type="text" id="aiBaseUrl" placeholder="https://api.openai.com/v1" />
            </label>
            <label>
              API Key
              <input type="password" id="aiApiKey" placeholder="sk-...（留空不变）" />
            </label>
            <label>
              模型
              <input type="text" id="aiModel" placeholder="gpt-4o-mini" />
            </label>
            <label>
              温度（0-1）
              <input type="number" step="0.1" min="0" max="1" id="aiTemp" />
            </label>
            <label>
              System Prompt（系统提示词）
              <textarea id="aiSystemPrompt" rows="5" placeholder="自定义系统提示词"></textarea>
            </label>
            <label>
              User Prompt 模板（可用 {title},{link},{pub_date},{author},{content} 占位符）
              <textarea id="aiUserPrompt" rows="8" placeholder="自定义用户提示词模板"></textarea>
            </label>
          </fieldset>

          <fieldset>
            <legend>Telegram 推送</legend>
            <label>
              启用Telegram推送
              <input type="checkbox" id="tgEnabled" />
            </label>
            <label>
              Bot Token
              <input type="password" id="tgToken" placeholder="（留空不变）" />
            </label>
            <label>
              Chat ID / Channel
              <input type="text" id="tgChatId" placeholder="@your_channel 或 chat id" />
            </label>
            <label class="switch">
              <input type="checkbox" id="tgPushSummary" />
              <span>推送抓取汇总到 Telegram</span>
            </label>
          </fieldset>

          <fieldset>
            <legend>飞书推送</legend>
            <label>
              启用飞书推送
              <input type="checkbox" id="fsEnabled" />
            </label>
            <label>
              Webhook URL
              <input type="text" id="fsWebhook" placeholder="https://open.feishu.cn/open-apis/bot/v2/hook/..." />
            </label>
            <label>
              Secret（可选，留空沿用旧值）
              <input type="password" id="fsSecret" placeholder="（留空不变）" />
            </label>
            <label class="switch">
              <input type="checkbox" id="fsPushSummary" />
              <span>推送抓取汇总到飞书</span>
            </label>
          </fieldset>

          <div class="actions">
            <button type="submit" class="primary">保存设置</button>
            <span id="saveStatus"></span>
          </div>
        </form>
      </section>
    </main>

    <div id="toast" class="toast">已保存</div>
    <button id="toTop" class="to-top" title="回到顶部">↑</button>

    <div id="modal" class="modal">
      <div class="modal-dialog">
        <div class="modal-header">
          <h3 id="modalTitle"></h3>
          <button class="ghost" data-close="1">✕</button>
        </div>
        <div class="modal-body">
          <div id="modalMeta" class="meta" style="margin-bottom:8px"></div>
          <div id="modalSummary" class="summary"></div>
        </div>
        <div class="modal-footer">
          <a id="modalLink" class="link" target="_blank" rel="noopener">在新标签打开原文</a>
          <button class="ghost" data-close="1">关闭</button>
        </div>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
  <script>
    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.dataset.tab;
        document.querySelectorAll('.tab').forEach(sec => sec.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
      });
    });
  </script>
</body>
</html>
